% This is the master file of the folder structure. In order to compile your document, run this file. In most LaTeX editors, the master file can be specified such that the document can also be compiled from the other .tex files (in the docs folder).

% First, the preamble needs to be called. This contains all the 'under the hood' stuff for your document.
\input{docs/preamble}

% The title page is created with the command \maketitle which needs to be placed after the \begin{document} command. To create the titlepage, some entries are needed: the name of the autor is defined by \author{}, the title by the entry \title{} and the date by the command \date{}. Note that the current date is displayed with \today.
\author{ 
Manuel Graf\\
  \texttt{grafm@cip.ifi.lmu.de}
  \and
  Michael A. Prummer\\
  \texttt{prummer@cip.ifi.lmu.de}
}
\title{Design of a Multiplayer Exergame for a Biofeedback System using Unity 3D
}
\date{\today}


\begin{document}

%\tableofcontents

\maketitle

\textbf{\input{docs/abstract}}

\begin{multicols}{2}

\section{Introduction}
Biofeedback is a relatively new method of treatment for mainly psychosomatic diseases. It can be used in many different ways through visualizing information about the physiological functions of the body. Biofeedback can be applied using various types of data, such as heart rate, brainwaves, body temperature or skin conductance of a patient. This data may help to improve the health and performance of an individual during a physical exercise or a treatment. Visualizing the participants vital parameters improves the perception of his own body and thus his health. By adapting to the given feedback patients can learn to affect their own body functions.\cite{BF2007} The recorded biofeedback data of patient during an exercise could be visualized and analyzed across multiple sessions. 

Besides this, Biofeedback could also be used to promote and motivate exercise for rehabilitation. Therefore, the biofeedback system can be combined with interactive applications, which hide the exhausting task of exercising behind a video game. Most things could be done more easily if we think of it as a game instead of work. Especially for rehabilitation, it may help to make boring exercises more entertaining, that have to be repeated continuously over a very long period, but are crucial for physical recovery. In order to combine interactive games with
exercise and biofeedback, we will introduce the concept of exergames (EG) and serious games (SG).

Games designed for a specific purpose, teaching a skill or educate can be referred as serious games. \cite{Derryberry} Serious games are a steady growing and relevant market since video games get more accepted in society. \cite{SGIndustry} The game prototype we seek to develop for the biofeedback system at the “Deutsches Herzzentrum” (DHZ), can be classified as a serious game based on the player movement or more specific, an exergame. “The activity of playing video games that involve physical exertion and are thought of as a form of exercise.” \cite{ExergameDef}

\section{Related Work}
There are many successful commercial “exergame platforms” like the Nintendo Wii or Wii Fit. Studies about the efficiency of the Wii according to the exercise, mostly shows different results. \cite{Baranowski2012} The major problem with most of the consumer systems is that the patient could easily adopt a strategy to trick the system to be successful in the game. Accordingly, we have to use our own motion tracking system with a camera to avoid such behavior in first place. Thus, exergames are not full replacements for real sports, they can be a great support in improving balance, endurance or help be more aware of specific problems. There are also many scientific evaluated studies from Baranowski \cite{Baranowski2008} and Kretschmann \cite{Kretschmann2010}, which have shown positive health related behavior changes in working together with video game setups.

Information we gathered from the evaluation of the previously developed exergames at the DHZ showed that single-player video games lacked the needed methods to sustain motivation. Playing the games for the first time could be a lot of fun while the concept of controlling the game over the biofeedback sensors is new to the player. But as already stated, this setup won't work quite well in keeping up the long term motivation for proceeding sessions.

\section{Game Concept}


\section{Input Devices and Sensors}
The biofeedback system game setup consists of two common ergometers, a motion sensor and a belt for measuring heart rate and respiration. The major goal of the game was to promote physical activity, in order to support the personal rehabilitation process. The game mechanics have to work driven by the tracked movement and vital parameters of the player. The main focus lays on the heart rate and cycling speed of the participants. The game play should cause a moderate rise of the player heart rate over time. The intensity shouldn't be too low, to obtain a relevant training effect and on the other hand not too high to be dangerous for the health. Critical parameters, like the target heart rate a player should reach to have an effective training should be assigned individually by a medical skilled supervisor.
Otherwise, for a normal person, the suggested heart rate for rehabilitation could be automatically set to 40\% of his maximal heart rate. The maximal heart rate could be calculated using the age of the player. Other considerable parameters, which could affect the game are the cycling speed of the ergometers, respiration values and motion tracking. The rounds per minute (RPM) of the ergometers are tracked over a magnet clamped behind the paddle. The magnet extension is crucial for this setup measuring the patient's cycling speed correctly. The ergometer will still output RPM values also if the player has stopped cycling and decrease very slowly. The game is played cycling on an ergometer and could either be controlled over the motion sensor or the game pad.

\begin{center}
\newcolumntype{C}[1]{>{\raggedright\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}

\begin{tabular}{ | C{2cm}  | C{4.25cm} | } \hline
	% Heading    
    Sensor & Output Parameter \\ \hline
	% Row 1
 	Kettler Ergometer & Cycling speed in RPM (Integer) \\ \hline
	% Row 2 	
    CSL Gamepad & Button states (Integer) Analog-Stick Values (Float) \\ \hline
   	% Row 3
    Zephyr Bioharness Strap & Heart-Rate and Respiration (Integer) \\ \hline
	% Row 4
    Asus Xtion Motion Sensor & Tracking of the upper body movements (Integer) \\ \hline    
    \end{tabular}
   \textit{Table 1: Sensors}
\end{center}

To connect all required medical sensors and peripheral devices with the Unity3D application, we used the AutoMedic Framework(MDC) developed by Dr. Mendoza\cite{Mendoza2011AutoMedic}. Basically, the framework and Unity3D instance exchange data over a Transmission Control Protocol(TCP) connection in both directions. Therefore, the Unity3D application opens a server socket with an IP address and port waiting for connections. We extended the MDC functionality to support multiplayer connectivity by automatically incrementing the port numbers if a port is already blocked by an other player. When the TCP connection was successful established, the MDC will send a package with an one byte identifier to notify and trigger the "level load" function in the Unity3D clients. The MDC records and forwards the player input values and measured biofeedback data to the clients, while all clients send their relevant player activities back to the MDC. The complete player sessions were stored in a database for further analyzing by a medical supervisor.



\section{Motivational Aspects}

A big challenge in creating a high qualitative exergame is to make it replayable and keep up a steady motivation over a longer period of time. Our goal was to develop a multiplayer racing exergame, which could be played together with up to eight players or an artificial intelligence. The game is meant to be embedded in the biofeedback system at the DHZ. We will also try to improve the game experience through controlling the karts with a motion sensor and through the implementation of various game elements, such as weapons system or collectable items, similar to the classic “Super Mario Kart” \cite{NitendoWiiMario} combat racing game. The game prototype has to be developed with the Unity3D game engine, based on the experience of the former developed games at the DHZ. The game should provide an initial motivation to start with exercising and support a better long term motivation through the multiplayer extension. Therefore, we what the game to be appropriate for the longer task of rehabilitation, especially with the target group of children and adolescents. 

Stuart Gray researched the connection between physical extent in exergamess and the motivational pull of head-to-head and leader board competitive games \cite{Gray2013}. Firstly, he analyzed different conducted studies which vary in their results regarding the effect of multiplayer competitive games on intrinsic motivation. The analyzed studies led him to the conclusion that competitive gameplay has a positive effect on highly competitive individuals whereas it tends to have negative or no effect at all on the intrinsic motivation of lowly competitive individuals. His main study was conducted on 33 participants, aged from 15 to 65, with an average age of 25, over a period of 4 weeks, and was analyzing the impact of competitive EG play on energy expenditure. Participants who played any competitive game mode spent significantly more time in anaerobic training zones (0.82 * HRmax - 1 * HRmax), suggesting that competitive conditions are more effective for energy expenditure than non-competitive conditions.


\section{Biofeedback Adaptations}

\section{Preliminary Study}

\section{Conclusion and Following Work}
Our goal was to develop a playable multilayer game prototype with Unity3D embedded in the biofeedback system at the DHZ. The study with the working prototype has shown that playing over a longer period of time does imply a rise in the heart rate of the probands and may therefore work as an alternative to classical rehabilitation approaches. The exergame successfully helped to take the focus away from the serious and exhausting rehabilitation exercise into a lighter game context. During the tests, probands were able to reach and hold their target heart rate with the help of the biofeedback system. The game therefore, tries to automatically adapt to the individually fitness and skill level of the players. Weaker players get support over stronger boosts, easier speed gain and simpler steer controls to provide a interesting and challenging game for all players. A medical skilled person could act as instructor and observe the game and players by the server interface or connected MDC application. The recorded biofeedback data gets stored in a database (Couch DB) and could be used for analysing the individual fitness and health status of a player.

Further work is needed to use this game for rehabilitation with children who had heart surgery. Controlling the game with an ergometer may be difficult for children with reduced physical mobility and needs further testing with the according target audience. A possibility to reduce the difficultly of the kart controlling for people with no video game experience, could be to implement a new game mode, where the player could only drive along the track on 3 fixed lines. The player could control his speed by cycling and would automatically drive along the defined track lines. Leaning to the side would cause the kart to jump one line left or right. This gamemode could be played by everyone. The level of challenge in this game mode could be controlled by the number of obstacles, spawned along the 3 track lines. A further advantage of this mode would be, that the game won't be permanently interrupted, because players can't drive against walls or get stuck anywhere.

Besides this, following work could be, to provide all further stored trainings sessions of the player to the game. The server application would be able to visualize the progress of a player over time and is open for more social and customizable features. Through that, the player can see the result of his effort he put in his exercise program. Furthermore, the server application could use the recorded player data to improve and individualize the biofeedback algorithms of the game logic for every player.

The AI could be improved with a state machine and self determining sensor system, which no
longer needs a static path mesh. An obstacle avoiding system, that could automatically detectand calculate an alternative path will also be needed for more complex tracks.
The complete system should be simplified and made playable at home with every common
ergometer. The client, server and MDC applications should be wrapped or merged in one userfriendly program, including a simple GUI. This could also help people to do their rehabilitation exercises at home if they are less mobile, but still want to exercise alone in a controlled way. The biofeedback system of the game can help to get better self knowledge about the own fitness status and help to improve self observation during exercising using the sensor system.

\end{multicols}



% The bibliography is printed with \bibliography{}. With the command \bibliographystyle{} a style is picked.

\bibliographystyle{plainnat}
\bibliography{refs/refs}

% To close your document, add the \end{document} command. Everything after this command will not be processed.
\end{document}